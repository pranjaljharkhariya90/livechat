<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P2P Global Chat</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            height: 100vh; display: flex; justify-content: center; align-items: center;
            font-family: 'Segoe UI', sans-serif; color: white;
        }
        @keyframes gradient { 0% {background-position: 0% 50%;} 50% {background-position: 100% 50%;} 100% {background-position: 0% 50%;} }
        
        #chat-card {
            width: 90%; max-width: 800px; height: 80vh;
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px);
            border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex; flex-direction: column; overflow: hidden;
        }

        #header { padding: 20px; background: rgba(0,0,0,0.3); text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        #messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        
        .msg { padding: 10px 15px; border-radius: 15px; max-width: 70%; font-size: 14px; }
        .sent { background: #00d2ff; color: #000; align-self: flex-end; }
        .received { background: rgba(255,255,255,0.2); align-self: flex-start; }
        
        #status-bar { padding: 10px 20px; font-size: 12px; background: rgba(0,0,0,0.2); color: #2ecc71; }

        #controls { padding: 20px; display: flex; gap: 10px; background: rgba(0,0,0,0.4); }
        input { flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 12px; border-radius: 10px; color: white; outline: none; }
        button { background: #2ecc71; border: none; padding: 0 20px; border-radius: 10px; color: black; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="chat-card">
    <div id="header">
        <h2>P2P Crystal Chat</h2>
        <p id="my-id-display">Generating ID...</p>
    </div>
    <div id="status-bar">Status: Waiting for connection...</div>
    <div id="messages"></div>
    
    <div id="controls">
        <input type="text" id="target-id" placeholder="Paste Friend's ID here...">
        <button id="connect-btn">Connect</button>
    </div>

    <div id="controls">
        <input type="text" id="msg-input" placeholder="Type a message...">
        <button id="send-btn">Send</button>
    </div>
</div>

<script>
    const messagesDiv = document.getElementById('messages');
    const msgInput = document.getElementById('msg-input');
    const sendBtn = document.getElementById('send-btn');
    const connectBtn = document.getElementById('connect-btn');
    const targetIdInput = document.getElementById('target-id');
    const statusDiv = document.getElementById('status-bar');
    const myIdDisplay = document.getElementById('my-id-display');

    // Initialize Peer
    const peer = new Peer(); 
    let conn;

    // Show your ID so you can send it to your friend
    peer.on('open', (id) => {
        myIdDisplay.innerText = "Your ID: " + id;
    });

    // Handle incoming connections
    peer.on('connection', (connection) => {
        conn = connection;
        setupChat();
    });

    // Handle clicking "Connect" to a friend
    connectBtn.onclick = () => {
        const friendId = targetIdInput.value;
        if (friendId) {
            conn = peer.connect(friendId);
            setupChat();
        }
    };

    function setupChat() {
        conn.on('open', () => {
            statusDiv.innerText = "Status: Online - Connected to peer!";
            statusDiv.style.color = "#2ecc71";
            addMessage("System", "You are now connected!", "received");
        });

        conn.on('data', (data) => {
            addMessage("Friend", data, "received");
        });

        conn.on('close', () => {
            statusDiv.innerText = "Status: Peer went Offline";
            statusDiv.style.color = "#e74c3c";
        });
    }

    sendBtn.onclick = () => {
        const msg = msgInput.value;
        if (msg && conn) {
            conn.send(msg);
            addMessage("You", msg, "sent");
            msgInput.value = '';
        }
    };

    function addMessage(user, text, type) {
        const div = document.createElement('div');
        div.className = `msg ${type}`;
        div.innerHTML = `<strong>${user}:</strong> ${text}`;
        messagesDiv.appendChild(div);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
</script>

</body>
</html>
